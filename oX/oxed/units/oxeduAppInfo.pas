{
   oxeduBuild, oxed build system
   Copyright (C) 2017. Dejan Boras
}

{$INCLUDE oxheader.inc}
UNIT oxeduAppInfo;

INTERFACE

   USES
      uStd, uFileUtils,
      uAppInfo,
      {oxed}
      uOXED, oxeduProject;

TYPE

   { oxedTAppInfo }

   oxedTAppInfo = record
      {recreate the app information include file}
      procedure Recreate(const where: StdString);
      procedure GetAppInfo(out info: appTInfo);

      {gets a auto generated source file header with optionally closed comment tag}
      function GetSourceHeader(close: boolean = true): TAppendableString;
   end;

VAR
   oxedAppInfo: oxedTAppInfo;

IMPLEMENTATION

{ oxedTAppInfo }

procedure oxedTAppInfo.Recreate(const where: StdString);
var
   p: TAppendableString;

begin
   p := GetSourceHeader();
   p.Add('');

   p.Add('appInfo.SetName(''' + oxedProject.Name + ''');');

   if(oxedProject.ShortName <> '') then
      p.Add('appInfo.NameShort := ''' + oxedProject.ShortName + ''';');

   p.Add('appInfo.SetOrganization(''' + oxedProject.Organization + ''');');

   if(oxedProject.OrganizationShort <> '') then
      p.Add('appInfo.OrgShort := ''' + oxedProject.OrganizationShort + ''';');

   p.Add('appInfo.SetVersion(1, 0);' + LineEnding);

   FileUtils.WriteString(where, p);
end;

procedure oxedTAppInfo.GetAppInfo(out info: appTInfo);
begin
   appTInfo.Initialize(info);

   info.SetName(oxedProject.Name);

   if(oxedProject.ShortName <> '') then
      appInfo.NameShort := oxedProject.ShortName;

   info.SetOrganization(oxedProject.Organization);

   if(oxedProject.OrganizationShort <> '') then
      info.OrgShort := oxedProject.OrganizationShort;

   appInfo.SetVersion(1, 0);
end;

function oxedTAppInfo.GetSourceHeader(close: boolean): TAppendableString;
begin
   Result := '{';
   Result.Add('   ' + oxedProject.Name + ' (' + oxedProject.Identifier + ')');

   if(oxedProject.Organization <> '') then
      Result.Add('   ' + oxedProject.Organization + ' (' + oxedProject.OrganizationShort + ')');

   Result.Add('   Automatically generated by OXED, any modifications will be lost');

   if(close) then
      Result.Add('}');
end;

END.
